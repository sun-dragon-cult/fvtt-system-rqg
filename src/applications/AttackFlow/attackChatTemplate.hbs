{{log "attackChatTemplate" this}}
<div class="rqg chat-card">
  <div class="flex-column gap03rem">
    <span {{#if (eq attackState 'Attacked')}} data-visible-actor-uuid="{{attackingActorUuid}}" {{/if}} data-attack-roll-html></span>
    <span data-defence-roll-html></span>
  </div>

  {{#if (eq attackState 'Attacked')}}
    <div class="flexrow">
      <button data-visible-actor-uuid="{{defendingActorUuid}}"
              data-defence="parry">Parry
      </button>
      <button data-visible-actor-uuid="{{defendingActorUuid}}"
              data-defence="dodge">Dodge
      </button>
      <button data-visible-actor-uuid="{{defendingActorUuid}}"
              data-defence="ignore">Ignore
      </button>
    </div>
  {{else if (eq attackState 'Defended')}}
    <div class="outcome-description">{{{outcomeDescription}}}</div>
    {{!-- use presence of damageRoll as sign of there being damage to roll, should be null:ed if no damage is to be rolled --}}
     {{#if damageRoll}} {{!-- TODO check if the defender should roll weapon damage instead, change data-visible-actor-uuid & supply some data to element --}}
      <button data-visible-actor-uuid="{{attackingActorUuid}}" data-damage-hitlocation>
        Roll some damage & hitlocation
      </button>
    {{/if}}

  {{else if (eq attackState 'DamageRolled')}}
    <div class="outcome-description">{{{outcomeDescription}}}</div>
    <div class="flex-column gap1rem">
      <span data-damage-roll-html></span>
      <span data-hit-location-roll-html></span>
      <div class="flex-row">
      {{#if hitLocationRoll}}
      {{#unless actorDamagedApplied}}
        <button data-visible-actor-uuid="{{attackingActorUuid}}" data-apply-damage-to-actor="true">
          Apply damage to actor
        </button>
      {{/unless}}
      {{/if}}
      {{#unless weaponDamageApplied}}
        <button
          data-visible-actor-uuid="{{defendingActorUuid}}" {{!-- TODO should be visible to the actor owning the weapon--}}
          data-damaged-weapon-uuid="{{damagedWeaponUuid}}">Apply damage to weapon
        </button>{{/unless}}
      </div>
    </div>
  {{/if}}

  {{#if attackerFumbled}}
    <button data-visible-actor-uuid="{{attackingActorUuid}}"
            data-fumble="attacker">Roll Attacker Fumble
    </button>
  {{/if}}

  {{#if defenderFumbled}}
    <button data-visible-actor-uuid="{{defendingActorUuid}}"
            data-fumble="defender">Roll Defender Fumble
    </button>
  {{/if}}

  {{#if attackerFumbleOutcome}}
    <b>Attacker Fumble:</b><br>
    {{{attackerFumbleOutcome}}}
  {{/if}}

  {{#if defenderFumbleOutcome}}
    <b>Defender Fumble:</b><br>
    {{{defenderFumbleOutcome}}}
  {{/if}}
</div>

